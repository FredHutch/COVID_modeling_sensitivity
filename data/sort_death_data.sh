#!/bin/sh
county=$1
sort -n -k1 -t',' unsorted_death.csv > sorted_death.csv
cat sorted_death.csv | awk -F',' 'BEGIN{pdate="";}{if (NR==1){printf("date,hosp_deaths1,hosp_deaths2,hosp_deaths3,hosp_deaths4,hosp_deaths,deaths1,deaths2,deaths3,deaths4,deaths\n");}else {if(NR==2 || $1==pdate){pdate=$1;if($2 < 20){death1++;if($3==1)hosp_death1++;}else{if ($2 < 50){death2++;if($3==1)hosp_death2++;}else{if ($2 < 70){death3++;if($3==1)hosp_death3++;}else{death4++;if($3==1)hosp_death4++;}}}} else {deaths+=death1+death2+death3+death4;hosp_deaths+=hosp_death1+hosp_death2+hosp_death3+hosp_death4;printf("%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n",pdate,hosp_death1,hosp_death2,hosp_death3,hosp_death4,hosp_deaths,death1,death2,death3,death4,deaths);pdate=$1;death1=0;death2=0;death3=0;death4=0;hosp_death1=0;hosp_death2=0;hosp_death3=0;hosp_death4=0;if($2<20){death1++;if($3==1)hosp_death1++;}else{if ($2 < 50){death2++;if($3==1)hosp_death2++;}else{if ($2 < 70){death3++;if($3==1)hosp_death3++;}else{death4++;if($3==1)hosp_death4++;}}}}}}' > $county\_county_death_by_age.csv
