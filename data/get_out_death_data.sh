#!/bin/sh
county=$1
#This script is used to populate the monthly variables for death_fract in kc_global_params.R
#
#This is the current header for IDM_king_county.csv.  If fields are added, be sure to adjust the offsets!
#CDC_EVENT_DATE_SARS,CREATE_DATE,DEATH_DATE,AGE_YEARS,Dead,CovidDeath,County,LabTestResult,SPECIMEN__COLLECTION__DTTM,SYMPTOM_ONSET_DATE,admitdate
echo "#Tallying out of hospital deaths by month/age..."
#cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && $3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { print $11;}}}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && $8 == "Positive") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}} END {printf("#hosp=%d, dead=%d(%g)\n#no_hosp_death_fract = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "02" || a[2] == "03") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Feb-Mar: hosp=%d, dead=%d(%g)\nno_hosp_death_fract1 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "04") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Apr: hosp=%d, dead=%d(%g)\nno_hosp_death_fract2 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "05") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#May: hosp=%d, dead=%d(%g)\nno_hosp_death_fract3 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "06") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Jun: hosp=%d, dead=%d(%g)\nno_hosp_death_fract4 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "07") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Jul: hosp=%d, dead=%d(%g)\nno_hosp_death_fract5 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "08") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Aug: hosp=%d, dead=%d(%g)\nno_hosp_death_fract6 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "09") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Sept: hosp=%d, dead=%d(%g)\nno_hosp_death_fract7 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "10") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Oct: hosp=%d, dead=%d(%g)\nno_hosp_death_fract8 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "11") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Nov: hosp=%d, dead=%d(%g)\nno_hosp_death_fract9 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "12") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Dec: hosp=%d, dead=%d(%g)\nno_hosp_death_fract10 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if (NR>1 && ($1 != "" || $2 != "") && $8 == "Positive"){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[1] == "2021" && a[2] == "01") {total++;if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if ($3 != "" && $5=="Dead" && $6=="Yes" && $11 !~ /2020/ && $11 !~ /2021/) { dead++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Jan: hosp=%d, dead=%d(%g)\nno_hosp_death_fract11 = c(%g,%g,%g,%g)\n",total,dead,dead/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
