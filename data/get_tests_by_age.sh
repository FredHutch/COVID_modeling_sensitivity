#!/bin/sh
#This script is used to populate the monthly variables for age_diag_frac in kc_global_params.R
#
echo "Tallying all tests by age group..."
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}} END {printf("Total: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "02" || a[2] == "03"){if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("2/1 - 3/31: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ( a[2] == "04"){if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("During April: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ( a[2] == "05"){if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("During May: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ( a[2] == "06"){if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("During June: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ( a[2] == "07"){if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("During July: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ( a[2] == "08"){if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("During August: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ( a[2] == "09"){if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("During Sept: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'
cat IDM_king_county.csv|awk -F',' '{if (NR>1){if (($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ( a[2] == "10"){if(is_uncertain==1){uncertain++;}tests++;if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("During Oct: tests=%d, child=%g,adult=%g,older=%g,senior=%g (date uncertainty=%g)\n",tests,child/tests,adult/tests,older/tests,senior/tests,uncertain/(tests));}'

echo "Tallying Positive tests..."
echo "Age,Cases,Deaths,Date"
cat IDM_king_county.csv|awk -F',' '{total++;if (NR>1 && ($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ($8 == "Positive" && (a[2] == "02" || a[2] == "03")){if(is_uncertain==1){uncertain++;}if($5=="Dead" && $6=="Yes"){test_death++}tests++;if ($4 < 20){if($5=="Dead" && $6=="Yes"){child_death++;}child++;}else{if ($4 < 50){if($5=="Dead" && $6=="Yes"){adult_death++;}adult++;}else{if ($4 < 70){if($5=="Dead" && $6=="Yes"){older_death++;}older++;}else{if($5=="Dead" && $6=="Yes"){senior_death++;}senior++}}}}}} END {printf("0-19,%d,%d,2020-03031\n",child,child_death);printf("20-49,%d,%d,2020-03031\n",adult,adult_death);printf("50-69,%d,%d,2020-03031\n",older,older_death);printf("70+,%d,%d,2020-03031\n",senior,senior_death);printf("Total,%d,%d,2020-03031\n",tests,test_death);}'
cat IDM_king_county.csv|awk -F',' '{total++;if (NR>1 && ($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ($8 == "Positive" && (a[2] == "02" || a[2] == "03"|| a[2] == "04")){if(is_uncertain==1){uncertain++;}if($5=="Dead" && $6=="Yes"){test_death++}tests++;if ($4 < 20){if($5=="Dead" && $6=="Yes"){child_death++;}child++;}else{if ($4 < 50){if($5=="Dead" && $6=="Yes"){adult_death++;}adult++;}else{if ($4 < 70){if($5=="Dead" && $6=="Yes"){older_death++;}older++;}else{if($5=="Dead" && $6=="Yes"){senior_death++;}senior++}}}}}} END {printf("0-19,%d,%d,2020-04-30\n",child,child_death);printf("20-49,%d,%d,2020-04-30\n",adult,adult_death);printf("50-69,%d,%d,2020-04-30\n",older,older_death);printf("70+,%d,%d,2020-04-30\n",senior,senior_death);printf("Total,%d,%d,2020-04-30\n",tests,test_death);}'
cat IDM_king_county.csv|awk -F',' '{total++;if (NR>1 && ($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ($8 == "Positive" && (a[2] == "02" || a[2] == "03"|| a[2] == "04"|| a[2] == "05")){if(is_uncertain==1){uncertain++;}if($5=="Dead" && $6=="Yes"){test_death++}tests++;if ($4 < 20){if($5=="Dead" && $6=="Yes"){child_death++;}child++;}else{if ($4 < 50){if($5=="Dead" && $6=="Yes"){adult_death++;}adult++;}else{if ($4 < 70){if($5=="Dead" && $6=="Yes"){older_death++;}older++;}else{if($5=="Dead" && $6=="Yes"){senior_death++;}senior++}}}}}} END {printf("0-19,%d,%d,2020-05-31\n",child,child_death);printf("20-49,%d,%d,2020-05-31\n",adult,adult_death);printf("50-69,%d,%d,2020-05-31\n",older,older_death);printf("70+,%d,%d,2020-05-31\n",senior,senior_death);printf("Total,%d,%d,2020-05-31\n",tests,test_death);}'
cat IDM_king_county.csv|awk -F',' '{total++;if (NR>1 && ($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ($8 == "Positive" && (a[2] == "02" || a[2] == "03"|| a[2] == "04"|| a[2] == "05"|| a[2] == "06")){if(is_uncertain==1){uncertain++;}if($5=="Dead" && $6=="Yes"){test_death++}tests++;if ($4 < 20){if($5=="Dead" && $6=="Yes"){child_death++;}child++;}else{if ($4 < 50){if($5=="Dead" && $6=="Yes"){adult_death++;}adult++;}else{if ($4 < 70){if($5=="Dead" && $6=="Yes"){older_death++;}older++;}else{if($5=="Dead" && $6=="Yes"){senior_death++;}senior++}}}}}} END {printf("0-19,%d,%d,2020-06-30\n",child,child_death);printf("20-49,%d,%d,2020-06-30\n",adult,adult_death);printf("50-69,%d,%d,2020-06-30\n",older,older_death);printf("70+,%d,%d,2020-06-30\n",senior,senior_death);printf("Total,%d,%d,2020-06-30\n",tests,test_death);}'
cat IDM_king_county.csv|awk -F',' '{total++;if (NR>1 && ($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ($8 == "Positive" && (a[2] == "02" || a[2] == "03"|| a[2] == "04"|| a[2] == "05"|| a[2] == "06"|| a[2] == "07")){if(is_uncertain==1){uncertain++;}if($5=="Dead" && $6=="Yes"){test_death++}tests++;if ($4 < 20){if($5=="Dead" && $6=="Yes"){child_death++;}child++;}else{if ($4 < 50){if($5=="Dead" && $6=="Yes"){adult_death++;}adult++;}else{if ($4 < 70){if($5=="Dead" && $6=="Yes"){older_death++;}older++;}else{if($5=="Dead" && $6=="Yes"){senior_death++;}senior++}}}}}} END {printf("0-19,%d,%d,2020-07-31\n",child,child_death);printf("20-49,%d,%d,2020-07-31\n",adult,adult_death);printf("50-69,%d,%d,2020-07-31\n",older,older_death);printf("70+,%d,%d,2020-07-31\n",senior,senior_death);printf("Total,%d,%d,2020-07-31\n",tests,test_death);}'
cat IDM_king_county.csv|awk -F',' '{total++;if (NR>1 && ($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ($8 == "Positive" && (a[2] == "02" || a[2] == "03"|| a[2] == "04"|| a[2] == "05"|| a[2] == "06"|| a[2] == "07"|| a[2] == "08")){if(is_uncertain==1){uncertain++;}if($5=="Dead" && $6=="Yes"){test_death++}tests++;if ($4 < 20){if($5=="Dead" && $6=="Yes"){child_death++;}child++;}else{if ($4 < 50){if($5=="Dead" && $6=="Yes"){adult_death++;}adult++;}else{if ($4 < 70){if($5=="Dead" && $6=="Yes"){older_death++;}older++;}else{if($5=="Dead" && $6=="Yes"){senior_death++;}senior++}}}}}} END {printf("0-19,%d,%d,2020-08-31\n",child,child_death);printf("20-49,%d,%d,2020-08-31\n",adult,adult_death);printf("50-69,%d,%d,2020-08-31\n",older,older_death);printf("70+,%d,%d,2020-08-31\n",senior,senior_death);printf("Total,%d,%d,2020-08-31\n",tests,test_death);}'
cat IDM_king_county.csv|awk -F',' '{total++;if (NR>1 && ($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ($8 == "Positive" && (a[2] == "02" || a[2] == "03"|| a[2] == "04"|| a[2] == "05"|| a[2] == "06"|| a[2] == "07"|| a[2] == "08"|| a[2] == "09")){if(is_uncertain==1){uncertain++;}if($5=="Dead" && $6=="Yes"){test_death++}tests++;if ($4 < 20){if($5=="Dead" && $6=="Yes"){child_death++;}child++;}else{if ($4 < 50){if($5=="Dead" && $6=="Yes"){adult_death++;}adult++;}else{if ($4 < 70){if($5=="Dead" && $6=="Yes"){older_death++;}older++;}else{if($5=="Dead" && $6=="Yes"){senior_death++;}senior++}}}}}} END {printf("0-19,%d,%d,2020-09-30\n",child,child_death);printf("20-49,%d,%d,2020-09-30\n",adult,adult_death);printf("50-69,%d,%d,2020-09-30\n",older,older_death);printf("70+,%d,%d,2020-09-30\n",senior,senior_death);printf("Total,%d,%d,2020-09-30\n",tests,test_death);}'
cat IDM_king_county.csv|awk -F',' '{total++;if (NR>1 && ($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if ($8 == "Positive" && (a[2] == "02" || a[2] == "03"|| a[2] == "04"|| a[2] == "05"|| a[2] == "06"|| a[2] == "07"|| a[2] == "08"|| a[2] == "09"|| a[2] == "10")){if(is_uncertain==1){uncertain++;}if($5=="Dead" && $6=="Yes"){test_death++}tests++;if ($4 < 20){if($5=="Dead" && $6=="Yes"){child_death++;}child++;}else{if ($4 < 50){if($5=="Dead" && $6=="Yes"){adult_death++;}adult++;}else{if ($4 < 70){if($5=="Dead" && $6=="Yes"){older_death++;}older++;}else{if($5=="Dead" && $6=="Yes"){senior_death++;}senior++}}}}}} END {printf("0-19,%d,%d,2020-10-31\n",child,child_death);printf("20-49,%d,%d,2020-10-31\n",adult,adult_death);printf("50-69,%d,%d,2020-10-31\n",older,older_death);printf("70+,%d,%d,2020-10-31\n",senior,senior_death);printf("Total,%d,%d,2020-10-31\n",tests,test_death);}'
