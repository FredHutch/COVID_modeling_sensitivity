#!/bin/sh
county=$1
#This script is used to populate the monthly variables for hosp_fract in kc_global_params.R
#
#This is the current header for IDM_king_county.csv.  If fields are added, be sure to adjust the offsets!
#CDC_EVENT_DATE_SARS,CREATE_DATE,DEATH_DATE,AGE_YEARS,Dead,CovidDeath,County,LabTestResult,SPECIMEN__COLLECTION__DTTM,SYMPTOM_ONSET_DATE,admitdate
echo "#Tallying data on hospitalization (based on onset date)..."
#cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive") {total++;if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { print $11;}}}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}} END {printf("#Overall pos=%d, hosp=%d(%g)\n#hosp_fract = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "02" || a[2] == "03") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Feb-Mar: pos=%d, hosp=%d(%g)\nhosp_fract1 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "04") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Apr: pos=%d, hosp=%d(%g)\nhosp_fract2 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "05") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#May: pos=%d, hosp=%d(%g)\nhosp_fract3 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "06") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Jun: pos=%d, hosp=%d(%g)\nhosp_fract4 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "07") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Jul: pos=%d, hosp=%d(%g)\nhosp_fract5 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "08") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Aug: pos=%d, hosp=%d(%g)\nhosp_fract6 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "09") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Sept: pos=%d, hosp=%d(%g)\nhosp_fract7 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "10") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Oct: pos=%d, hosp=%d(%g)\nhosp_fract8 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "11") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Nov: pos=%d, hosp=%d(%g)\nhosp_fract9 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[2] == "12") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Dec: pos=%d, hosp=%d(%g)\nhosp_fract10 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[1] == "2021" && a[2] == "01") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Jan: pos=%d, hosp=%d(%g)\nhosp_fract11 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
#add line below when Feb is available
#cat IDM_$county\_county.csv|awk -F',' '{if ($8 == "Positive" &&($1 != "" || $2 != "")){if ($1 != ""){is_uncertain=0;split($1,a,"-");}else{is_uncertain=1;split($2,a,"-");}if (a[1] == "2021" && a[2] == "02") {total++; if ($4 < 20){child_total++;}else{if ($4 < 50){adult_total++;}else{if ($4 < 70){older_total++;}else{senior_total++;}}}if (NR>1 && ($11 !="" && $11!="FALSE")||($5=="Dead" && $6=="Yes")) { hosp++; if ($4 < 20){child++;}else{if ($4 < 50){adult++;}else{if ($4 < 70){older++;}else{senior++}}}}}}} END {printf("#Feb: pos=%d, hosp=%d(%g)\nhosp_fract12 = c(%g,%g,%g,%g)\n",total,hosp,hosp/total,child/child_total,adult/adult_total,older/older_total,senior/senior_total);}'
